var myutil = require('./myutil');

var mysql = require('mysql');
var connection = mysql.createConnection({
	host:		'localhost',
	user:		'root',
	password: 	'3306',
	database:	'blog'
});
	
connection.connect();

exports.saveData = function(req)
{
	
	var article = {
		tittle		:	req.body.articleTittle,
		authorName	:	req.body.articleAuthor ||'lyle',
		publishTime	:	new Date(),
		content		:	req.body.articleBody
	}
	//console.log("收到数据 \n title:"+article.tittle+"\n"+"authorName:"+article.authorName+"\n"+article.content);
		
	var query = connection.query('insert into article set ?',article,function(err,result){
		if(err)
			console.log("数据库插入错误\n"+err);
		else
			console.log(JSON.stringify(result));
	});	
	console.log(query.sql);
}
exports.getArticleList = function(res,number){
	var sql = 'select * from article order by publishTime desc limit '+number;
	console.log("执行sql:\n"+sql);
	connection.query(sql,function(err,results)
	{
		if(err)
		{
			console.log("数据库X查询错误\n"+err);
			return 0;
		}
		else
		{
			//console.log(results);	
			if(results.length>0)
			{	
				//console.log(results);	
				for(var i = 0; i < results.length; i++)
				{
					results[i].publishTime = myutil.getDate(results[i].publishTime);
					console.log("处理后的时间是:"+results[i].publishTime);
				}					
				res.render('list',{article:results});
			}	
		}
	});
}
